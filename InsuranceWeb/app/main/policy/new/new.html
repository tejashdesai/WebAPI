<div class="row">
    <div class="col-lg-12">
        <div class="widget ">
            <div class="widget-header">
                <i class="fa fa-users" ng-class="icon"></i> Add/Edit Policy
            </div>
            <div class="widget-body ">
                <div class="widget-content row">
                    <form novalidate name="new.frmPolicy" ng-submit="new.frmPolicy.$valid && new.savePolicy()">
                        <div class="col-xs-12 no-padding">
                            <div class="col-xs-12">
                                <div class="col-lg-4 form-group">
                                    <label for="name">Name:</label>
                                    <input type="text" name="name" ng-model="new.policyData.name" required class="form-control">
                                    <div ng-messages="(new.frmPolicy.$submitted || new.frmPolicy.name.$touched) && new.frmPolicy.name.$error" class="text-danger"
                                        role="alert">
                                        <div ng-message="required">Please enter name.</div>
                                    </div>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <label for="policyNumber">Policy Number:</label>
                                    <input type="text" name="policyNumber" ng-model="new.currentPolicy.policyNumber" required class="form-control">
                                    <div ng-messages="(new.frmPolicy.$submitted || new.frmPolicy.policyNumber.$touched) && new.frmPolicy.policyNumber.$error"
                                        class="text-danger" role="alert">
                                        <div ng-message="required">Please enter policy number.</div>
                                    </div>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <label for="policyType">Policy Type:</label>
                                    <select name="policyType" ng-model="new.policyData.policyType" class="form-control" required ng-options="item.value as item.text for item in new.policyTypeData ">
                                    </select>
                                    <div ng-messages="(new.frmPolicy.$submitted || new.frmPolicy.policyType.$touched) && new.frmPolicy.policyType.$error" class="text-danger"
                                        role="alert">
                                        <div ng-message="required">Please select policy type.</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12">
                                <div class="col-lg-4 form-group ">
                                    <label for="startDate ">Start Date:<span class="required-mark ">*</span></label>
                                    <div class="input-group date">
                                        <div class="input-group-addon" ng-click="new.openDate('startDate')">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </div>
                                        <input type="text" name="startDate" class="form-control" uib-datepicker-popup="dd-MM-yyyy" ng-model="new.date.startDate"
                                            is-open="new.open.startDate" datepicker-options="new.allDateOption" ng-change="new.startDateChanged()"
                                            placeholder="dd-mm-yyyy" ng-required="true" />
                                    </div>
                                    <div ng-messages="(new.frmPolicy.$submitted || new.frmPolicy.startDate.$touched) && new.frmPolicy.startDate.$error" class="text-danger"
                                        role="alert">
                                        <div ng-message="required">Please enter start date.</div>
                                    </div>
                                </div>
                                <div class="col-lg-4 form-group ">
                                    <label for="endDate ">End Date:<span class="required-mark ">*</span></label>
                                    <div class="input-group date">
                                        <div class="input-group-addon" ng-click="new.openDate('endDate')">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </div>
                                        <input type="text" class="form-control" uib-datepicker-popup="dd-MM-yyyy" ng-model="new.date.endDate" is-open="new.open.endDate"
                                            datepicker-options="new.endDateOption" placeholder="dd-mm-yyyy" ng-required="true"
                                            name="endDate" />
                                    </div>
                                    <div ng-messages="(new.frmPolicy.$submitted || new.frmPolicy.endDate.$touched) && new.frmPolicy.endDate.$error" class="text-danger"
                                        role="alert">
                                        <div ng-message="required">Please enter end date.</div>
                                    </div>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <label for="mobile">Mobile:</label>
                                    <input type="text" name="mobile" required ng-model="new.policyData.mobile" class="form-control">
                                    <div ng-messages="(new.frmPolicy.$submitted || new.frmPolicy.mobile.$touched) && new.frmPolicy.mobile.$error" class="text-danger"
                                        role="alert">
                                        <div ng-message="required">Please enter mobile number.</div>
                                        <div ng-message="pattern">Invalid mobile number.</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12">
                                <div class="col-lg-4 form-group">
                                    <label for="address1">Address 1:</label>
                                    <input type="text" name="address1" required ng-model="new.policyData.address1" class="form-control">
                                    <div ng-messages="(new.frmPolicy.$submitted || new.frmPolicy.address1.$touched) && new.frmPolicy.address1.$error" class="text-danger"
                                        role="alert">
                                        <div ng-message="required">Please enter address1.</div>
                                    </div>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <label for="address1">Address 2:</label>
                                    <input type="text" name="address2" ng-model="new.policyData.address2" class="form-control">
                                </div>
                                <div class="col-lg-4 form-group">
                                    <label for="city">City:</label>
                                    <input type="text" name="city" required ng-model="new.policyData.city" class="form-control" required>
                                    <div ng-messages="(new.frmPolicy.$submitted || new.frmPolicy.city.$touched) && new.frmPolicy.city.$error" class="text-danger"
                                        role="alert">
                                        <div ng-message="required">Please enter city.</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12">
                                <div class="col-lg-4 form-group">
                                    <label for="email">Email:</label>
                                    <input type="text" name="email" required ng-pattern="new.emailPattern" ng-model="new.policyData.email" class="form-control">
                                    <div ng-messages="(new.frmPolicy.$submitted || new.frmPolicy.email.$touched) && new.frmPolicy.email.$error" class="text-danger"
                                        role="alert">
                                        <div ng-message="required">Please enter email.</div>
                                        <div ng-message="pattern">Invalid email.</div>
                                    </div>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <label for="additionalName1">Additional Name 1:</label>
                                    <input type="text" name="additionalName1" ng-model="new.policyData.additionalName1" class="form-control">
                                </div>
                                <div class="col-lg-4 form-group">
                                    <label for="additionalName2">Additional Name 2:</label>
                                    <input type="text" name="additionalName2" ng-model="new.policyData.additionalName2" class="form-control">
                                </div>

                            </div>
                            <div class="col-xs-12">
                                <div class="col-lg-4 form-group">
                                    <label for="additionalName3">Additional Name 3:</label>
                                    <input type="text" name="additionalName3" ng-model="new.policyData.additionalName3" class="form-control">
                                </div>
                                <div class="col-lg-4 form-group">
                                    <label for="policyAmount">Amount:</label>
                                    <input type="number" name="policyAmount" required ng-model="new.currentPolicy.policyAmount" class="form-control">
                                    <div ng-messages="(new.frmPolicy.$submitted || new.frmPolicy.policyAmount.$touched) && new.frmPolicy.policyAmount.$error"
                                        class="text-danger" role="alert">
                                        <div ng-message="required">Please enter amount.</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12">
                                <div class="col-xs-12 form-group">
                                    <label for="fileUpload" style="display:block">Attachment</label>
                                    <input type="file" id="fileUpload" name="fileUpload" accept=".xlsx,.xls,.doc,.docx,.pdf,.csv,.jpg,.jpeg,.png,.bmp" file-upload
                                        selected-file="new.tempUploadedFiles" is-multiple="false" max-size="5" error-message="new.fileError"
                                        class="form-control file-upload" style="display:inline" />
                                    <a href='javascript:void(0)' class='text-left' ng-click="new.addFile()">Add</a>
                                    <p ng-show="new.fileError.invalid">{{new.fileError.message}}</p>
                                </div>
                                <div class="col-xs-12 no-padding">
                                    <div class="col-xs-4 no-padding">
                                        <div class="col-xs-12 no-padding" ng-repeat="item in new.uploadedFiles">
                                            <span class="col-xs-10">{{item.name}}</span>
                                            <span class="col-xs-2 text-danger" ng-click="new.removeFile(item)"><i class="fa fa-close"></i></span>
                                        </div>
                                        <div class="col-xs-12" ng-show="new.uploadedFiles.length === 0">
                                            No file uploaded.
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="col-xs-12" ng-if="new.policyId">
                                <div class="col-xs-12">
                                    <h4 class="col-xs-8  no-padding">Policy History</h4>
                                    <button type="button" class="pull-right btn btn-info" ng-click="new.addPolicyHistory()">Add Policy History</button>
                                </div>
                                <div class="col-xs-12">
                                    <table class="table table-responsive">
                                        <thead>
                                            <tr>
                                                <th>Start Date</th>
                                                <th>End Date</th>
                                                <th>Amount</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="item in new.policyData.policyHistory | filter: {'isDeleted' : false} track by $index">
                                                <td>{{item.startDate | date: 'dd-MM-yyyy'}}</td>
                                                <td>{{item.endDate | date: 'dd-MM-yyyy'}}</td>
                                                <td>{{item.policyAmount}}</td>
                                                <td>
                                                    <a href="" ng-click="new.editPolicyHistory(item)">Edit</a> |
                                                    <a href="" ng-click="new.deletePolicyHistory(item)">Delete</a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-lg-6 button-row">
                                <button type="submit" class="btn btn-success"> Save Policy</button>
                                <button type="button" ng-click="new.resetPolicy()" class="btn btn-warning"> Cancel</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/ng-template" id="policyHistoryModal.html">
    <div class="modal-header">
        <h3 class="modal-title" id="modal-title">Policy History</h3>
    </div>
    <div class="modal-body row" id="modal-body">
        <form novalidate name="history.frmPolicyHistory" ng-submit="history.frmPolicyHistory.$valid && history.savePolicyHistory()">
            <div class="col-xs-12">
                <div class="col-lg-12 form-group ">
                    <label for="startDate ">Start Date:<span class="required-mark ">*</span></label>
                    <div class="input-group date">
                        <div class="input-group-addon" ng-click="history.openDate('startDate')">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </div>
                        <input type="text" name="startDate" class="form-control" uib-datepicker-popup="dd-MM-yyyy" ng-model="history.policyHistoryData.startDate"
                            is-open="history.open.startDate" datepicker-options="history.allDateOption" ng-change="history.startDateChanged()"
                            placeholder="dd-mm-yyyy" ng-required="true" />
                    </div>
                    <div ng-messages="(history.frmPolicyHistory.$submitted || history.frmPolicyHistory.startDate.$touched) && history.frmPolicyHistory.startDate.$error"
                        class="text-danger" role="alert">
                        <div ng-message="required">Please enter start date.</div>
                    </div>
                </div>
                <div class="col-lg-12 form-group ">
                    <label for="endDate ">End Date:<span class="required-mark ">*</span></label>
                    <div class="input-group date">
                        <div class="input-group-addon" ng-click="history.openDate('endDate')">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </div>
                        <input type="text" class="form-control" uib-datepicker-popup="dd-MM-yyyy" ng-model="history.policyHistoryData.endDate" is-open="history.open.endDate"
                            datepicker-options="history.endDateOption" placeholder="dd-mm-yyyy" ng-required="true" name="endDate"
                        />
                    </div>
                    <div ng-messages="(history.frmPolicyHistory.$submitted || history.frmPolicyHistory.endDate.$touched) && history.frmPolicyHistory.endDate.$error"
                        class="text-danger" role="alert">
                        <div ng-message="required">Please enter end date.</div>
                    </div>
                </div>
                <div class="col-lg-12 form-group">
                    <label for="mobile">Amount:</label>
                    <input type="number" name="policyAmount" required ng-model="history.policyHistoryData.policyAmount" class="form-control">
                    <div ng-messages="(history.frmPolicyHistory.$submitted || history.frmPolicyHistory.policyAmount.$touched) && history.frmPolicyHistory.policyAmount.$error"
                        class="text-danger" role="alert">
                        <div ng-message="required">Please enter amount.</div>
                    </div>
                </div>
            </div>

            <div class="col-xs-12 text-right">
                <button type="submit" class="btn btn-primary" type="button">OK</button>
                <button class="btn btn-warning" type="button" ng-click="history.cancel()">Cancel</button>
            </div>

        </form>
    </div>

</script>